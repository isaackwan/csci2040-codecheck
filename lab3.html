<!DOCTYPE HTML>
<html>
<head>
	<script src="//cdn.rawgit.com/brython-dev/brython/3.3.4/www/src/brython.js"></script>
	<script src="//cdn.rawgit.com/brython-dev/brython/3.3.4/www/src/brython_stdlib.js"></script>
</head>
<body onload="brython({cache: 'browser', debug: 1})">
	<script type="text/python" src="/py3/lab3.py"></script>
	<div id="drop_zone" style="background-color: grey; min-height: 3em;">Loading...</div>
	<div id="result" style="margin-top: 3em;white-space: pre-wrap;">Result goes here...<br></div>
	<script type="text/javascript">
		document.getElementById("drop_zone").addEventListener("dragover", function(e){
			e.stopPropagation();
			e.preventDefault();
			e.dataTransfer.dropEffect = "copy";
		});
		document.getElementById("drop_zone").addEventListener("drop", function(e) {
			e.stopPropagation();
			e.preventDefault();
			console.debug(e.dataTransfer.files);
			var files = Array.from(e.dataTransfer.files);
			files = files.map((file) => new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.onload = (ev) => {
					e.target.dispatchEvent(new CustomEvent("upload", {detail: {name: file.name, body: ev.target.result}}));
					resolve({name: file.name, body: ev.target.result});
				};
				reader.onerror = (e) => {
					reject({event: e});
				}
				reader.readAsText(file)
			}));
			console.debug(files);
			Promise.all(files)
				.then((files) => e.target.dispatchEvent(new CustomEvent("finishedUpload", {detail: files})))
				.catch(e => {
					document.getElementById("result").innerText += e;
				});
		});
	</script>
</body>
</html>
